# 04-测试与验收

待 M1 完成后记录：
- Codex 自测结果
- 主代理复测结果
- 问题清单与修复记录

## M1测试记录（2026-02-16）
- 构建测试：`npm run build`
- 烟雾测试：`bash scripts/smoke.sh`
- 预期策略：
  - 无 `AI_BUILDER_TOKEN`：输出 SKIP 提示并返回 0（非崩溃）。
  - 有 `AI_BUILDER_TOKEN`：请求 AI Builder 并检查返回结构。

## 本次修复 + M2 测试记录（2026-02-16）
- smoke 修复验证：`bash scripts/smoke.sh`
  - 结果：通过，返回 `[SMOKE][PASS] AI Builder 接口可用，返回了内容。`
  - 验证点：默认模型已切换为 `supermind-agent-v1`，不再触发 Unsupported model `gpt-4o-mini`。
- 构建验证：`npm run build`
  - 结果：通过（Next.js production build 成功）。
- 图片接口联通验证：
  - 命令：`curl -X POST https://space.ai-builders.com/backend/v1/images/generations`（使用 `AI_BUILDER_TOKEN`，模型 `gpt-image-1.5`）
  - 结果：HTTP 200，返回 `data[0].b64_json`。
- 功能验收点：
  - 前端“生成海报图”可触发 `/api/couplet/poster` 并展示图片。
  - 前端“下载海报图”可下载当前展示图片。
  - 图片生成失败时展示明确错误文案，春联文本结果保持可见且可复制。

## M3 测试记录（2026-02-16）
- 构建验证：`npm run build`
  - 结果：通过（生产构建成功）。
- 烟雾验证：`bash scripts/smoke.sh`
  - 结果：通过（无 token 时 SKIP 且退出 0；有 token 时应 PASS）。
- 移动端检查（390px）：
  - 输入区、结果区、海报区均无横向溢出。
  - 主要按钮（生成春联/生成海报/复制/下载）高度满足触控友好（>=44px）。
  - 生成春联与生成海报期间，重复提交按钮均被禁用并有加载文案。
- 接口验收点：
  - `POST /api/couplet/generate` 与 `POST /api/couplet/poster` 成功/失败均返回 `requestId`。
  - 超时场景返回明确错误文案（含“超时”），便于用户重试。
  - 服务端日志仅包含 `requestId/durationMs/statusCode/errorType`，未记录 token 或完整上游响应。
