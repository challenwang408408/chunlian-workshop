# 02-需求与拆解

## 页面与交互
- 输入：主题、风格、行业、语气、可选禁忌词。
- 输出：上联、下联、横批、解释、风格标签。
- 操作：生成、复制、重试、（M2）生成海报并下载。
- 异常态：接口超时、返回不合法、MCP不可达。

## 接口契约（目标）
- POST /api/couplet/generate
  - req: { theme, style, industry, tone, tabooWords? }
  - resp: { topLine, bottomLine, horizontal, explanation, styleTags }
- POST /api/couplet/poster (M2)
  - req: { topLine, bottomLine, horizontal, stylePreset }
  - resp: { imageUrl | imageBase64 }

## 模块拆解
- M1 项目骨架与文案生成
- M2 海报图生成与下载
- M3 移动端优化、日志与交付文档

## 风险点
- AI Builder 接口参数/鉴权不一致
- 图片生成接口可用性与时延
- 春联格式稳定性（字数、对仗）

## M1实现补充（2026-02-16）
- 页面：`app/page.tsx`
  - 已支持主题/风格/行业/语气/禁忌词输入。
  - 已支持生成、错误提示、结果复制。
- 接口：`app/api/couplet/generate/route.ts`
  - 入参校验：`lib/couplet-schema.ts`
  - 上游仅使用 `https://space.ai-builders.com/backend/v1/chat/completions`
  - 鉴权仅使用 `AI_BUILDER_TOKEN`
- 工程配置：已补齐 `next.config.ts`、`tsconfig.json`、`next-env.d.ts`、`.env.example`。
- 自测：`scripts/smoke.sh` 在无 token 时 SKIP 且退出 0；有 token 时执行连通性验证。
